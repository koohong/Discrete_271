{
  "hash": "0d92f627876816a3e6ac6095527983c1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Logistic regression\"\nformat:\n  html:\n    toc: true\n    html-math-method: katex\n    css: style.css  \n    theme:\n      light: cosmo\n      dark: [cosmo, theme-dark.scss]\nexecute: \n   echo: false\neditor_options: \n  chunk_output_type: console\n---\n\n```{=html}\n<style>\n.table-hover > tbody > tr:hover { \n  background-color: #f4f442;\n}\n</style>\n```\n\n\n\n\n\n\nReading CH 2.1, 2.2.1-2.2.4 (page 61- 94)\n\n# Logistic regression \n\n- In CH1, we first focused on estimating $\\pi$\n- Then, $\\pi_1$ and $\\pi_2$ and independent groups \n  - Briefly talked about `matched pair` case where $\\pi_1$ and $\\pi_2$ are dependent. \n  \n- Now we start talking about many different possible probabilities of success to estimate and perform inference upon.\n\n\n## Functional form\n\n$$\\pi_i = \\frac{\\text{exp}(\\beta_0 + \\beta_1x_{i,1}+...++ \\beta_px_{i,p})}{1+\\text{exp}(\\beta_0 + \\beta_1x_{i,1}+...++ \\beta_px_{i,p})}$$\n\n$$\\text{logit}(\\pi_i)=\\text{log}(\\frac{\\pi_i}{1-\\pi_i}) = \\beta_0 + \\beta_1x_{i,1}+...++ \\beta_px_{i,p}$$\n- Unfortunately, there are only a few simple cases where these parameter estimates have `closed-form solutions`; i.e., we cannot generally write out the parameter estimates in terms of the observed data like we could for the single probability estimate $\\pi$ in Section 1.1.2. \n\n- Instead, we use iterative numerical procedures, as described in Appendix B.3.2, to successively find estimates of the regression parameters that increase the log-likelihood function\n\n## parameter estimation in R\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#get data\nplacekick <- read.table(here(\"data\",\"Placekick.csv\"),header = T, sep = \",\")\n\nplacekick %>% head %>% kable(\"html\") %>% \n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> week </th>\n   <th style=\"text-align:right;\"> distance </th>\n   <th style=\"text-align:right;\"> change </th>\n   <th style=\"text-align:right;\"> elap30 </th>\n   <th style=\"text-align:right;\"> PAT </th>\n   <th style=\"text-align:right;\"> type </th>\n   <th style=\"text-align:right;\"> field </th>\n   <th style=\"text-align:right;\"> wind </th>\n   <th style=\"text-align:right;\"> good </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 24.7167 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 15.8500 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.4500 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 28 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 13.5500 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 21.8667 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 17.6833 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n#fit the model\nmod.fit <- glm(formula = good ~ distance , family =\nbinomial(link = logit), data = placekick)\n\nlatex_equation <- extract_eq(mod.fit)\nprint(latex_equation)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$$\n\\log\\left[ \\frac { P( \\operatorname{good} = \\operatorname{1} ) }{ 1 - P( \\operatorname{good} = \\operatorname{1} ) } \\right] = \\alpha + \\beta_{1}(\\operatorname{distance})\n$$\n```\n\n\n:::\n:::\n\n\n\n\n\n\n# ODDS\n\n- see page 83, the odd of success at a particular value of `x`\n\n$$\\text{Odds}_x = \\text{exp}(\\beta_0 + \\beta_1x)$$\n\n\n# Log odds to probability\n\n-   Your aunt offers a service in which she weights coins to make them unfair.\n\n-   You give her a coin and tell her how much you want the `log-odds` to change. She returns the modified coin.\n\n-   For each of the following orders, use your function to compute the resulting probability of heads:\n\n    -   fair coin, increase log-odds by 1.\n    -   fair coin, increase log-odds by 2.\n    -   fair coin, increase log-odds by 10.\n    -   fair coin, decrease log-odds by 1.\n    -   fair coin, decrease log-odds by 2.\n    -   fair coin, decrease log-odds by 10.\n\n-   Write an R function that computes the `probability of heads`, given log-odds.\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.5\n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> log_odds </th>\n   <th style=\"text-align:right;\"> probability </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0.881 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.731 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.500 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 0.269 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> 0.119 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> -10 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n-   In you own words, describe how changes in log-odds translate to changes in probability\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](wk2_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n-   You can see in this plot, As log-odds increase, the probability of success increases relative to the probability of failure, and it approaches one. As log-odds decrease probability of success decrease and converges to zero.\n\n-   If you get log-odds values that are very very small like -10 the probability of success is almost zero, and if you get log-odds values that are very big like 10 or the probability of success is almost one.\n\n-   The relationship between log-odd and probability is not linear, but of s-curve type, and log odds ratios ranging from -5 to +5 create probabilities that range from just above 0 to very close to 1.\n\n\n# Case Study: South African Heart Disease\n\n## Introduction \n\n- Target: `Probability of getting coronary heart disease`, `chd` \n- Feature:\n  - High blood pressure, high LDL cholesterol, diabetes, smoking, secondhand smoke exposure, obesity, an unhealthy diet, and physical inactivity are among the leading risk factors for heart disease.\n\n- Data Source:\n  Source: Rousseauw, J., du Plessis, J., Benade, A., Jordaan, P., Kotze, J. and Ferreira, J. (1983). Coronary risk factor screening in three rural communities, South African   Medical Journal 64: 430â€“436.\n\n## Data Description \n\n  - sbp: systolic blood pressure\n  - tobacco: cumulative tobacco use (kg)\n  - ldl: low density lipoprotein cholesterol ('bad' cholestrol)\n  - adiposity: Body adiposity index determines body fat percentage(calculated as (HC / (HM)1.5) - 18,\n    where HC = Hip Circumference in Centimetres and HM = Height in meters)\n  - famhist: family history of heart disease\n  - typea: A personality type that could raise one's chances of developing coronary heart disease\n  - obesity: Body Mass Index (BMI) ($kg/m^2$)\n  - alcohol: current alcohol consumption\n  - age: age at onset\n  - `chd`: coronary heart disease\n\n\\newpage\n\n# Exploratory Analysis\n\nFor this case study, we focus on blood pressure, smoking, cholesterol, and age.\n\n- Load the data and answer the following questions:\n\n  - What are the number of variables and number of observations?\n  - What is the type of each variable? Do we need to change it? \n  - Are there any missing values (in each of the variables)?\n  - Are there any abnormal values in each of the variables in the raw data?\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> tobacco </th>\n   <th style=\"text-align:right;\"> ldl </th>\n   <th style=\"text-align:right;\"> sbp </th>\n   <th style=\"text-align:right;\"> age </th>\n   <th style=\"text-align:right;\"> chd </th>\n   <th style=\"text-align:right;\"> obesity </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 12.00 </td>\n   <td style=\"text-align:right;\"> 5.73 </td>\n   <td style=\"text-align:right;\"> 160 </td>\n   <td style=\"text-align:right;\"> 52 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 25.30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.01 </td>\n   <td style=\"text-align:right;\"> 4.41 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 28.87 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.08 </td>\n   <td style=\"text-align:right;\"> 3.48 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n   <td style=\"text-align:right;\"> 46 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 29.14 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7.50 </td>\n   <td style=\"text-align:right;\"> 6.41 </td>\n   <td style=\"text-align:right;\"> 170 </td>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 31.99 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 13.60 </td>\n   <td style=\"text-align:right;\"> 3.50 </td>\n   <td style=\"text-align:right;\"> 134 </td>\n   <td style=\"text-align:right;\"> 49 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 25.99 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6.20 </td>\n   <td style=\"text-align:right;\"> 6.47 </td>\n   <td style=\"text-align:right;\"> 132 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 30.77 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n## Univariate Analysis\n\n- The response (or dependent) variable of interest, Heart disease, is a binary variable taking the type factor.  \n\n- Use a bar chart to explore the distribution of the response variable (chd). What do you learn?\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> Heart disease </th>\n   <th style=\"text-align:right;\"> N </th>\n   <th style=\"text-align:right;\"> Proportion </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 302 </td>\n   <td style=\"text-align:right;\"> 0.65 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 160 </td>\n   <td style=\"text-align:right;\"> 0.35 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n::: {.cell-output-display}\n![](wk2_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\nFor metric variables, a density plot or histogram allows us to determine the shape of the distribution and look for outliers.\n\n- Use a density plot to explore the distribution of explanatory variables. What do you discover? \n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](wk2_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n\n\n\n## Bivariate Analysis\n\n- Prior to moving on to the fully specified model, it is advisable to first examine the simple associations between the response and each explanatory variable.\n\n- `Box plots` are useful for exploring the association between a categorical variable and a variable measured on an interval scale.\n\n- Use a `boxplot` to examine how the explanatory variables are correlated with the response variable (chd)?\n\n  - The `coord_flip()` function is used to keep the dependent variable on the y-axis.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](wk2_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\\newpage\n\n- Use the convenient summary_factorlist() function from the finalfit package to tabulate data. \n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Dependent: chd </th>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:left;\"> 0 </th>\n   <th style=\"text-align:left;\"> 1 </th>\n   <th style=\"text-align:left;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> ldl </td>\n   <td style=\"text-align:left;\"> Mean (SD) </td>\n   <td style=\"text-align:left;\"> 4.3 (1.9) </td>\n   <td style=\"text-align:left;\"> 5.5 (2.2) </td>\n   <td style=\"text-align:left;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sbp </td>\n   <td style=\"text-align:left;\"> Mean (SD) </td>\n   <td style=\"text-align:left;\"> 135.5 (18.0) </td>\n   <td style=\"text-align:left;\"> 143.7 (23.7) </td>\n   <td style=\"text-align:left;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tobacco </td>\n   <td style=\"text-align:left;\"> Mean (SD) </td>\n   <td style=\"text-align:left;\"> 2.6 (3.6) </td>\n   <td style=\"text-align:left;\"> 5.5 (5.6) </td>\n   <td style=\"text-align:left;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> age </td>\n   <td style=\"text-align:left;\"> Mean (SD) </td>\n   <td style=\"text-align:left;\"> 38.9 (14.9) </td>\n   <td style=\"text-align:left;\"> 50.3 (10.6) </td>\n   <td style=\"text-align:left;\"> &lt;0.001 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n- According to the plots and the tables, What variable is most important for explaining heart disease? How is that variable correlated with heart disease?\n\n\n\\newpage\n\n# Model Development\n\n## Linear probability model\n\n- Is the linear probability model an appropriate choice to study the relationship between heart disease and risk factors?\n\n- Estimate the following linear probability model and interpret the model results.\n\n$$ chd = \\beta_0 + \\beta_1 ldl + \\beta_2 sbp + + \\beta_3 tobacco + \\beta_4 age + u$$\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = chd ~ ldl + sbp + tobacco + age, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-0.8439 -0.3405 -0.1250  0.4365  1.0172 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -0.3493578  0.1405912  -2.485 0.013315 *  \nldl          0.0362419  0.0102322   3.542 0.000438 ***\nsbp          0.0009739  0.0010670   0.913 0.361839    \ntobacco      0.0165577  0.0049101   3.372 0.000809 ***\nage          0.0076831  0.0016886   4.550 6.89e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4318 on 457 degrees of freedom\nMultiple R-squared:  0.1853,\tAdjusted R-squared:  0.1781 \nF-statistic: 25.98 on 4 and 457 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n\n- What are the advantages and disadvantages of the linear probability model?\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](wk2_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\\newpage\n\n##  Generalized linear model\n\n- Estimate the following logistic regression model and interpret the model results.\n\n$$ logit(\\pi_i) =\\beta_0 + \\beta_1 ldl + \\beta_2 sbp + + \\beta_3 tobacco + \\beta_4 age +  u$$\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = chd ~ ldl + sbp + tobacco + age, family = binomial(link = logit), \n    data = df)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9457  -0.8595  -0.4999   1.0238   2.3906  \n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -4.535524   0.781360  -5.805 6.45e-09 ***\nldl          0.185131   0.054121   3.421 0.000625 ***\nsbp          0.004307   0.005394   0.798 0.424623    \ntobacco      0.075982   0.025616   2.966 0.003016 ** \nage          0.046264   0.009852   4.696 2.66e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 596.11  on 461  degrees of freedom\nResidual deviance: 502.19  on 457  degrees of freedom\nAIC: 512.19\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n\n\n###  Interpretation of model results\n\n- Do the `raw` coefficient estimates `directionally make sense`?\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = chd ~ ldl + sbp + tobacco + age, family = binomial(link = logit), \n    data = df)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.9457  -0.8595  -0.4999   1.0238   2.3906  \n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -4.535524   0.781360  -5.805 6.45e-09 ***\nldl          0.185131   0.054121   3.421 0.000625 ***\nsbp          0.004307   0.005394   0.798 0.424623    \ntobacco      0.075982   0.025616   2.966 0.003016 ** \nage          0.046264   0.009852   4.696 2.66e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 596.11  on 461  degrees of freedom\nResidual deviance: 502.19  on 457  degrees of freedom\nAIC: 512.19\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n\n\n- > **Again, all of the explanatory variables except blood pressure are statistically significant and positively correlated with the probability of heart disease, same as the linear probability model.**\n\n\n- Recall that (page 83)\n\n$$\n\\text{OR} = \\frac{\\text{Odds}_{x_k+c}}{\\text{Odds}_{x_k}}=exp(c \\beta_k)\n$$\n- The odd of a success change by exp(c$\\beta_k$) `times` for every c-unit increase in x  \n\n- Compute and interpret the estimated odds ratio for a 10-unit increase in each explanatory variable.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Replace with your code\nround(exp(10*coef(mod.logit.h0)),2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)         ldl         sbp     tobacco         age \n       0.00        6.37        1.04        2.14        1.59 \n```\n\n\n:::\n:::\n\n\n\n\n\n> **The estimated odds of success or having a heart disease change by 6.37 times for every 10-unit increase in LDL or 'bad' cholesterol.** \n    \n> **Interestingly, the odds of having a heart disease is almost 1 for every 10-unit increase in blood pressure, which means an increase in blood pressure doesn't change the odds of having heart disease, and it's consistent with its insignificant coefficient.**\n\n\n# Statistical Inference\n\n\n## Hypothesis Test\n\n- Using the likelihood ratio test (LRT) for hypothesis testing is a common practice in a logistic regression model. \n\n- Use LRT to test whether ($obesity$) is associated with heart disease.\n\n  - $H_0: \\beta_{obesity} = 0$\n\n  - $H_a: \\beta_{obesity} \\ne 0$\n\nUse both *Anova()* or *anova()* functions.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#mod.logit.ha <- # uncomment and replace with your code\nmod.logit.ha <- glm(chd ~ ldl + sbp +tobacco + age + obesity, family = binomial(link = logit), data = df)\n\n#anova()\nanova(mod.logit.h0, mod.logit.ha, test = \"Chisq\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table\n\nModel 1: chd ~ ldl + sbp + tobacco + age\nModel 2: chd ~ ldl + sbp + tobacco + age + obesity\n  Resid. Df Resid. Dev Df Deviance Pr(>Chi)\n1       457     502.19                     \n2       456     501.07  1   1.1191   0.2901\n```\n\n\n:::\n\n```{.r .cell-code}\n#Anova()\nAnova(mod.logit.ha, test = \"LR\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: chd\n        LR Chisq Df Pr(>Chisq)    \nldl      13.3932  1  0.0002525 ***\nsbp       0.8640  1  0.3526279    \ntobacco   9.4670  1  0.0020920 ** \nage      24.3447  1  8.055e-07 ***\nobesity   1.1191  1  0.2901078    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n## Deviance \n\n- `deviance` refers to the amount that a particular model deviates from another model as measured by $-2\\text{log}(\\Lambda)$. \n\n- What are the null deviance and residual deviance in the model summary?\n  - For `null` and `residual deviance`, the alternative model we use is the `saturated model`, which has a different coefficent for each data point, leading to perfect prediction, a likelihood of one, and a log likelihood of zero.\n\n- The `null deviance` measures the performance of the worst model using only `an intercept`, providing a benchmark.\n\n$$\n\\text{Null Deviance}= -2 \\text{log}(L(\\hat{\\beta_0}|y_1,..., y_n))\n$$\n\n- The `residual deviance` is the deviance of our fitted model. \n  - It is always greater than zero unless it is the saturated model / explains the data perfectly.\n\n$$\n\\text{Residual Deviance}= -2 \\text{log}(L(\\hat{\\beta}|y_1,..., y_n))\n$$\n\n- Therefore, how much better (smaller) our residual deviance is compared to the null deviance and how close it is to zero is a measure of model fit.\n\n- Sometimes people will compute an $R^2$ for logistic regression using $1-\\frac{\\text{Residual Deviance}}{\\text{Null Deviance}}$ since it is bounded between 0 (residual deviance = null deviance) and 1 (residual deviance = saturated model = 0).\n\n- Note that we can compute deviance of two separate models by substracting the null model residual deviance and the alternative model residual deviance from separate logistic regression fits. (Why is this?)\n\n- Using deviance, test whether ($obesity$) is associated with heart disease.\n\n  - $H_0: \\beta_{obesity} = 0$\n\n  - $H_a: \\beta_{obesity} \\ne 0$\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n> **We get a p-value of 0.29, the same as what we got from both anova() and Anova() functions, and again we fail to reject the null hypothesis that obesity is not correlated with heart disease given this data set.** \n\n\n\n##  Confidence Interval\n\n### Confidence Interval for odds ratio\n\n**Wald Confidence:**\n\n$$\nc*\\hat{\\beta_k} \\pm c*Z_{1-\\alpha/2} \\sqrt{\\widehat{Var}(\\hat{\\beta}_k)}\n$$\n\n$$\nexp \\left(c*\\hat{\\beta_k} \\pm c*Z_{1-\\alpha/2} \\sqrt{\\widehat{Var}(\\hat{\\beta}_k)} \\right)\n$$\n\n- Calculate Wald CI for odds ratio of 10-unit increase in LDL cholesterol  based on the above formula:\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n             (Intercept)           ldl           sbp       tobacco\n(Intercept)  0.610523787 -9.955527e-03 -3.315082e-03  1.122271e-03\nldl         -0.009955527  2.929029e-03 -1.336470e-05 -4.923675e-06\nsbp         -0.003315082 -1.336470e-05  2.909849e-05 -1.506782e-06\ntobacco      0.001122271 -4.923675e-06 -1.506782e-06  6.562050e-04\nage         -0.001828353 -6.178475e-05 -1.503794e-05 -7.699037e-05\n                      age\n(Intercept) -1.828353e-03\nldl         -6.178475e-05\nsbp         -1.503794e-05\ntobacco     -7.699037e-05\nage          9.706566e-05\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]  2.20 18.39\n```\n\n\n:::\n:::\n\n\n\n\n\n> **With 95% confidence, the odds of having a  heart disease change between 2.20 to 18.4 times for every 10-unit increase in LDL or 'bad' cholesterol.**\n\n\n- What is the main concern with Wald CI?\n\n\n> **Wald confidence interval has a true confidence level close to the 95% only when we have large samples. When the sample size is not large, profile LR confidence intervals generally perform better.**\n\n\n- Now calculate the *profile likelihood ratio (LR)* confidence interval using the confint function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Replace with your code\nbeta_ci <- confint(mod.logit.h0)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWaiting for profiling to be done...\n```\n\n\n:::\n\n```{.r .cell-code}\nodds_ci <- exp(10*beta_ci)\n\nround(cbind(odds_ci ),2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            2.5 % 97.5 %\n(Intercept)  0.00   0.00\nldl          2.24  18.84\nsbp          0.94   1.16\ntobacco      1.31   3.59\nage          1.31   1.93\n```\n\n\n:::\n:::\n\n\n\n\n\n> **Since we have a large sample, 462 observations, the profile likelihood ratio (LR) confidence interval is pretty close to the Wald CI.**\n\n### Confidence Interval for the Probability of Success\n\n- Recall that the estimated probability of success is\n$$\n\\hat{\\pi} = \\frac{exp \\left( \\hat{\\beta}_0 + \\hat{\\beta}_1 x_1 + \\dots + \\hat{\\beta}_K x_k \\right)}{1+exp \\left(\\hat{\\beta}_0 + \\hat{\\beta}_1 x_1 + \\dots + \\hat{\\beta}_K x_k \\right)}\n$$\n\nWhile backing out the estimated probability of success is straightforward, obtaining its confidence interval is not, as it involves many parameters.\n\n**Wald Confidence Interval**\n\n$$\n\\hat{\\beta}_0 + \\hat{\\beta}_1 x_1 + \\dots + \\hat{\\beta}_K x_K \\pm Z_{1-\\alpha/2} \\sqrt{\\widehat{Var}(\\hat{\\beta}_0 + \\hat{\\beta}_1 x_1 + \\dots + \\hat{\\beta}_K x_K)} \n$$\n\nwhere \n\n$$\n\\widehat{Var}(\\hat{\\beta}_0 + \\hat{\\beta}_1 x_1 + \\dots + \\hat{\\beta}_K x_K) = \\sum_{i=0}^K x_i^2 \\widehat{Var}(\\hat{\\beta_i}) + 2 \\sum_{i=0}^{K-1} \\sum_{j=i+1}^{K} x_i x_j \\widehat{Cov}(\\hat{\\beta}_i,\\hat{\\beta}_j)\n$$\n\nSo, the Wald Interval for $\\pi$ is\n\n$$\n\\frac{exp \\left( \\hat{\\beta}_0 + \\hat{\\beta}_1 x_1 + \\dots + \\hat{\\beta}_K x_k \\pm \\sqrt{\\sum_{i=0}^K x_i^2 \\widehat{Var}(\\hat{\\beta_i}) + 2 \\sum_{i=0}^{K-1} \\sum_{j=i+1}^{K} x_i x_j \\widehat{Cov}(\\hat{\\beta}_i,\\hat{\\beta}_j)}  \\right)}{1+exp \\left(\\hat{\\beta}_0 + \\hat{\\beta}_1 x_1 + \\dots + \\hat{\\beta}_K x_k \\right)  \\pm \\sqrt{\\sum_{i=0}^K x_i^2 \\widehat{Var}(\\hat{\\beta_i}) + 2 \\sum_{i=0}^{K-1} \\sum_{j=i+1}^{K} x_i x_j \\widehat{Cov}(\\hat{\\beta}_i,\\hat{\\beta}_j)}}\n$$\n\n- For an average value of all explanatory variables, compute the Confidence Interval for the Probability of Success given the formula above\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n  pi.hat  lower  upper\n1 0.3089 0.2925 0.3259\n```\n\n\n:::\n:::\n\n\n\n\n\n### Final Visualization\n\n- Using both the linear probability and logistic regression models, plot the estimated probability of heart disease for different values of cholesterol, holding other variables constant at their average level.\n\n- Discuss which one can better explain this relationship.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](wk2_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\\newpage\n\n### Final Report\n\n- Display both estimated linear and logistic models in a regression table. Is there any significant difference between their results?\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\nTable 1: The estimated relationship between heart disease and risk factors\n==================================================\n                         Dependent variable:      \n                    ------------------------------\n                                 chd              \n                           OLS          logistic  \n                           (1)             (2)    \n--------------------------------------------------\nldl                      0.036***       0.185***  \n                         (0.010)         (0.054)  \n                                                  \nsbp                       0.001           0.004   \n                         (0.001)         (0.005)  \n                                                  \ntobacco                  0.017***        0.076**  \n                         (0.005)         (0.026)  \n                                                  \nage                      0.008***       0.046***  \n                         (0.002)         (0.010)  \n                                                  \nConstant                 -0.349*        -4.536*** \n                         (0.141)         (0.781)  \n                                                  \n--------------------------------------------------\nObservations               462             462    \nR2                        0.185                   \nAdjusted R2               0.178                   \nLog Likelihood                          -251.093  \nAkaike Inf. Crit.                        512.187  \nResidual Std. Error  0.432 (df = 457)             \n==================================================\nNote:                *p<0.05; **p<0.01; ***p<0.001\n```\n\n\n:::\n:::\n\n\n\n\n> **In both models, all the coefficients except blood pressure are statistically significant and positively associated with the probability of having heart disease. Also, LDL is the most correlated variable with the probability of heart disease in both models.**    \n\n\n# Terms\n\n\n\n\n\n\n::: {#tbl-penguins-top10 .cell tbl-cap='First 10 Penguins'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> wk </th>\n   <th style=\"text-align:left;\"> Term </th>\n   <th style=\"text-align:left;\"> Description </th>\n   <th style=\"text-align:left;\"> $$\\text{equals to}$$ </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> wk1 </td>\n   <td style=\"text-align:left;\"> odd </td>\n   <td style=\"text-align:left;\"> For a Bernoulli random variable with parameter $p$, the odds are defined as the ratio of the probability of success to the probability of failure, </td>\n   <td style=\"text-align:left;\"> $$\\text{Odd}=\\frac{p}{1-p}$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk1 </td>\n   <td style=\"text-align:left;\"> logit </td>\n   <td style=\"text-align:left;\"> This is log of odd </td>\n   <td style=\"text-align:left;\"> $$\\text{logit}(p)=\\text{log}\\frac{p}{1-p}$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk1 </td>\n   <td style=\"text-align:left;\"> odd </td>\n   <td style=\"text-align:left;\"> from logit, you can get odd.  This expression will be used a lot later. </td>\n   <td style=\"text-align:left;\"> $$\\text{exp}(x) =\\frac{p}{1-p}$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk1 </td>\n   <td style=\"text-align:left;\"> probability </td>\n   <td style=\"text-align:left;\"> this is probability of success in binary respose case </td>\n   <td style=\"text-align:left;\"> $$p = \\frac{exp(x)}{1+exp(x)}$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> saturated model </td>\n   <td style=\"text-align:left;\"> This model is frequently referred as the `saturated model` because the number of parameters is equal to the number of observations, so that no additional parameters can be estimated. It refers to observed proportions of success. See p81 </td>\n   <td style=\"text-align:left;\"> $$\\text{logit}(\\pi_i) = \\gamma_i$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> likelihood </td>\n   <td style=\"text-align:left;\"> Also known as likelihood function.  It measures how well a statistical model explains observed data by calculating the probability of seeing that data under different parameter values of the model. </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> likelihood ratio test </td>\n   <td style=\"text-align:left;\"> Likelihood ratio test (LRT) is a statistic. P17.  Note that this is $\\Lambda$ </td>\n   <td style=\"text-align:left;\"> $$\\Lambda = \\frac{\\text{MLR under} H_0}{\\text{MLR under} H_0 \\text{ or } H_a}$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> deviance </td>\n   <td style=\"text-align:left;\"> the amount that a particular model deviates from another model measured by the transformed LRT,$-2log(\\Lambda)$, see p 81 </td>\n   <td style=\"text-align:left;\"> $$-2\\text{log}(\\Lambda)$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> null deviance </td>\n   <td style=\"text-align:left;\"> The null deviance denotes how much the probabilities estimated from the model logit$(\\pi_i)=\\beta_0$ for all observation.  Measured in transformed LRT, $-2log(\\Lambda)$ </td>\n   <td style=\"text-align:left;\"> The $\\pi_i$ is estaimted to be the same value for this particular model. See p81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> residual deviance </td>\n   <td style=\"text-align:left;\"> measures how much probabilities estimated from a model of interest deviatesfrom the `observed proportions of success`. Residual deviance statistics are often calculated as an intermediate step for performing a LRT to compare two models.  Measured in transformed LRT, $-2log(\\Lambda)$ </td>\n   <td style=\"text-align:left;\"> It is a measure of overall goodness of fit for a model.  When you have two different models $H_0$ and $H_a$, you can estimate `the transformed LRT` of $H_0$ by comparing the logit($\\pi^{(0)}$ with `saturated model` and also that of $H_a$.  When you subtract  the transformed  LRT of $H_0$ from that of $H_a$, it measures the probability of success under the $H_0$ and $H_a$. p77 and 81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> transformed likelihood ratio test statistic </td>\n   <td style=\"text-align:left;\"> transformed likelihood ratio test (LRT) statistic follows chi-square degress of freedom.  Recommend using it. Better than the Wald Interval </td>\n   <td style=\"text-align:left;\"> $$\n-2log(\\Lambda) = -2log( \\frac{L(\\hat{{\\beta}}^{(0)} | y_1,..., y_n)}{L(\\hat{{\\beta}}^{(a)} | y_1,..., y_n)})\n= -2\\sum y_i log( \\frac{\\hat{\\pi}_i^{(0)}}{\\hat{\\pi}_i^{(a)}}) + (1 - y_i ) log( \\frac{1- \\hat{\\pi}_i^{(0)}}{1- \\hat{\\pi}_i^{(a)}})\n$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> $\\text{Odds}_x$ </td>\n   <td style=\"text-align:left;\"> The odds of a success at a particular value of x. p83 </td>\n   <td style=\"text-align:left;\"> $$\\text{Odds}_x = exp(\\beta_0 + \\beta_1x) $$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> $\\text{Odds}_{x+c}$ </td>\n   <td style=\"text-align:left;\"> The odds of a success when x is changed by c. p83 </td>\n   <td style=\"text-align:left;\"> $$\\text{Odds}_{x+c} = exp(\\beta_0 + \\beta_1(x+c)) $$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> odd ratio </td>\n   <td style=\"text-align:left;\"> OR is operator. See the bottom of page 82.  It should be E[X].  The odds of a success change by exp($c\\beta_1$ ) times for every c-unit increase in x. </td>\n   <td style=\"text-align:left;\"> $$\\frac{\\text{Odds}_{x+c}}{\\text{Odds}_x}=\\frac{exp(\\beta_0 + \\beta_1(x+c))}{exp(\\beta_0 + \\beta_1x)}=exp(c\\beta_1)$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk2 </td>\n   <td style=\"text-align:left;\"> $\\hat{\\text{OR}}$ </td>\n   <td style=\"text-align:left;\"> the estimated odd ratio, and its confidence interval can be found by `confint()` </td>\n   <td style=\"text-align:left;\"> $$\\hat{\\text{OR}} =\\text{exp}(c\\hat{\\beta})$$ </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wk3 </td>\n   <td style=\"text-align:left;\"> $\\hat{\\pi}$ </td>\n   <td style=\"text-align:left;\"> probability of succuss in logistic regression. P86 </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "wk2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}