<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>logit – Discrete Response</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-dc9e717b3fbf52f64798667d9ecbfc31.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Discrete Response</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./wk1.html"> 
<span class="menu-text">Binary groups</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./wk2.html" aria-current="page"> 
<span class="menu-text">logit</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./wk4P1.html"> 
<span class="menu-text">Multinomial</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./wk4P2.html"> 
<span class="menu-text">Nominol response regression model</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./wk4P3.html"> 
<span class="menu-text">Ordinal response regression models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./wk5.html"> 
<span class="menu-text">Possion regression</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#generalized-linear-models-glm" id="toc-generalized-linear-models-glm" class="nav-link active" data-scroll-target="#generalized-linear-models-glm">Generalized linear models (GLM)</a>
  <ul class="collapse">
  <li><a href="#link-function" id="toc-link-function" class="nav-link" data-scroll-target="#link-function">Link function</a></li>
  </ul></li>
  <li><a href="#parameter-estimation-in-r" id="toc-parameter-estimation-in-r" class="nav-link" data-scroll-target="#parameter-estimation-in-r">Parameter estimation in R</a>
  <ul class="collapse">
  <li><a href="#mod.fit" id="toc-mod.fit" class="nav-link" data-scroll-target="#mod.fit">Mod.fit()</a>
  <ul class="collapse">
  <li><a href="#hypothesis-tests-for-regression-parameters" id="toc-hypothesis-tests-for-regression-parameters" class="nav-link" data-scroll-target="#hypothesis-tests-for-regression-parameters">Hypothesis tests for regression parameters</a></li>
  <li><a href="#lrt" id="toc-lrt" class="nav-link" data-scroll-target="#lrt">LRT</a></li>
  <li><a href="#transformed-lrt" id="toc-transformed-lrt" class="nav-link" data-scroll-target="#transformed-lrt">Transformed LRT</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#deviance" id="toc-deviance" class="nav-link" data-scroll-target="#deviance">Deviance</a>
  <ul class="collapse">
  <li><a href="#saturated-model" id="toc-saturated-model" class="nav-link" data-scroll-target="#saturated-model">Saturated model</a></li>
  <li><a href="#null-deviance" id="toc-null-deviance" class="nav-link" data-scroll-target="#null-deviance">Null deviance</a></li>
  <li><a href="#residual-deviance" id="toc-residual-deviance" class="nav-link" data-scroll-target="#residual-deviance">Residual deviance</a></li>
  </ul></li>
  <li><a href="#probability" id="toc-probability" class="nav-link" data-scroll-target="#probability">Probability</a>
  <ul class="collapse">
  <li><a href="#confidence-interval-of-the-pi-estimate" id="toc-confidence-interval-of-the-pi-estimate" class="nav-link" data-scroll-target="#confidence-interval-of-the-pi-estimate">confidence interval of the <span class="math inline">\pi</span> estimate</a></li>
  </ul></li>
  <li><a href="#odds" id="toc-odds" class="nav-link" data-scroll-target="#odds">ODDS</a>
  <ul class="collapse">
  <li><a href="#odd-ratio" id="toc-odd-ratio" class="nav-link" data-scroll-target="#odd-ratio">ODD Ratio</a>
  <ul class="collapse">
  <li><a href="#understanding-the-changes-in-odd" id="toc-understanding-the-changes-in-odd" class="nav-link" data-scroll-target="#understanding-the-changes-in-odd">Understanding the changes in odd</a></li>
  <li><a href="#example-of-magin-coin" id="toc-example-of-magin-coin" class="nav-link" data-scroll-target="#example-of-magin-coin">Example of magin coin</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#case-study-south-african-heart-disease" id="toc-case-study-south-african-heart-disease" class="nav-link" data-scroll-target="#case-study-south-african-heart-disease">Case Study: South African Heart Disease</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task">Task</a></li>
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda">EDA</a></li>
  <li><a href="#mrl" id="toc-mrl" class="nav-link" data-scroll-target="#mrl">MRL</a></li>
  <li><a href="#glm" id="toc-glm" class="nav-link" data-scroll-target="#glm">GLM</a>
  <ul class="collapse">
  <li><a href="#odd-ratio-1" id="toc-odd-ratio-1" class="nav-link" data-scroll-target="#odd-ratio-1">Odd ratio</a></li>
  <li><a href="#hypothesis-test" id="toc-hypothesis-test" class="nav-link" data-scroll-target="#hypothesis-test">Hypothesis Test</a></li>
  <li><a href="#confidence-interval" id="toc-confidence-interval" class="nav-link" data-scroll-target="#confidence-interval">Confidence Interval</a></li>
  </ul></li>
  <li><a href="#final-visualization" id="toc-final-visualization" class="nav-link" data-scroll-target="#final-visualization">Final Visualization</a></li>
  <li><a href="#final-report" id="toc-final-report" class="nav-link" data-scroll-target="#final-report">Final Report</a></li>
  </ul></li>
  <li><a href="#case-study-osteoporosis" id="toc-case-study-osteoporosis" class="nav-link" data-scroll-target="#case-study-osteoporosis">Case Study: osteoporosis</a>
  <ul class="collapse">
  <li><a href="#background-1" id="toc-background-1" class="nav-link" data-scroll-target="#background-1">Background</a></li>
  <li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1">Task</a></li>
  <li><a href="#eda-1" id="toc-eda-1" class="nav-link" data-scroll-target="#eda-1">EDA</a></li>
  <li><a href="#glm-1" id="toc-glm-1" class="nav-link" data-scroll-target="#glm-1">GLM</a>
  <ul class="collapse">
  <li><a href="#simple-model" id="toc-simple-model" class="nav-link" data-scroll-target="#simple-model">simple model</a></li>
  <li><a href="#model-with-categorical-feature" id="toc-model-with-categorical-feature" class="nav-link" data-scroll-target="#model-with-categorical-feature">model with categorical feature</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">logit</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style>
.table-hover > tbody > tr:hover { 
  background-color: #f4f442;
}
</style>
<p>Reading Christopher R. Bilder and Thomas M. Loughin. Analysis of Categorical Data with R. CRC Press. 2015. - CH 2.1, 2.2.1-2.2.4 (page 61- 94) - Ch. 2.2.5 – 2.2.8, 2.3 (page 94)</p>
<ul>
<li><p>In CH1, we first focused on estimating <span class="math inline">\pi</span></p></li>
<li><p>Then, <span class="math inline">\pi_1</span> and <span class="math inline">\pi_2</span> and independent groups</p>
<ul>
<li>Briefly talked about <code>matched pair</code> case where <span class="math inline">\pi_1</span> and <span class="math inline">\pi_2</span> are dependent.</li>
</ul></li>
<li><p>Now we start talking about many different possible probabilities of success to estimate and perform inference upon.</p></li>
<li><p>Use <code>odd</code> to estimate parameters and use <code>odd ratio</code> to evaluate the estimated parameters.</p></li>
</ul>
<section id="generalized-linear-models-glm" class="level1">
<h1>Generalized linear models (GLM)</h1>
<ul>
<li><p>GLMs have three different parts (see page 121:</p>
<ol type="1">
<li>Random Component:
<ul>
<li><span class="math inline">Y</span>, for logistic regression, <span class="math inline">Y</span> has a Bernoulli distribution</li>
</ul></li>
<li>Systematic Component:
<ul>
<li>This specifies a linear combination of the regression parameters with <code>features</code>, and this part is referred to as the <code>linear predictor</code></li>
<li><span class="math inline">\beta_0 + \beta_1x_1 + .... + \beta_px_p</span></li>
</ul></li>
<li>LINK FUNCTION:
<ul>
<li>Specifies how the expected value of the <code>random component</code> <span class="math inline">E[Y]</span> is linked to the <code>sysmatic</code> component.</li>
<li><span class="math inline">\text{logit}(\pi) = \beta_0 + \beta_1x_1 + .... + \beta_px_p</span></li>
<li>where <span class="math inline">E[Y] = \pi</span></li>
</ul></li>
</ol></li>
</ul>
<section id="link-function" class="level2">
<h2 class="anchored" data-anchor-id="link-function">Link function</h2>
<p><span class="math display">\text{logit}(\pi_i)=\text{log}(\frac{\pi_i}{1-\pi_i}) = \beta_0 + \beta_1x_{i,1}+...++ \beta_px_{i,p}</span></p>
<ul>
<li><p>Unfortunately, there are only a few simple cases where these parameter estimates have <code>closed-form solutions</code>; i.e., we cannot generally write out the parameter estimates in terms of the observed data like we could for the single probability estimate <span class="math inline">\pi</span> in Section 1.1.2.</p></li>
<li><p>Instead, we use iterative numerical procedures, as described in Appendix B.3.2, to successively find estimates of the regression parameters that increase the log-likelihood function</p></li>
</ul>
</section>
</section>
<section id="parameter-estimation-in-r" class="level1">
<h1>Parameter estimation in R</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>placekick <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"Placekick.csv"</span>),<span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>placekick <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="st">"html"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">week</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">change</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">elap30</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PAT</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">field</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">good</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.7167</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15.8500</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.4500</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13.5500</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">21.8667</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.6833</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fit the model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mod.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> good <span class="sc">~</span> distance , <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> logit), <span class="at">data =</span> placekick)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>mod.fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = good ~ distance, family = binomial(link = logit), 
    data = placekick)

Coefficients:
(Intercept)     distance  
      5.812       -0.115  

Degrees of Freedom: 1424 Total (i.e. Null);  1423 Residual
Null Deviance:      1013 
Residual Deviance: 775.7    AIC: 779.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># latex_equation &lt;- extract_eq(mod.fit)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(latex_equation)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mod.fit" class="level2">
<h2 class="anchored" data-anchor-id="mod.fit">Mod.fit()</h2>
<p><span class="math display">
\log\left[ \frac { P( \operatorname{good} = \operatorname{1} ) }{ 1 - P( \operatorname{good} = \operatorname{1} ) } \right] = 5.812 +- 0.115\cdot(\operatorname{distance})
</span></p>
<ul>
<li>You can get confidence interval this way</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mod.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %      97.5 %
(Intercept)  5.1958841  6.47715198
distance    -0.1318144 -0.09907103</code></pre>
</div>
</div>
<ul>
<li>also this way</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = good ~ distance, family = binomial(link = logit), 
    data = placekick)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7441   0.2425   0.2425   0.3801   1.6092  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  5.812080   0.326277   17.81   &lt;2e-16 ***
distance    -0.115027   0.008339  -13.79   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1013.43  on 1424  degrees of freedom
Residual deviance:  775.75  on 1423  degrees of freedom
AIC: 779.75

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>page74</p>
<section id="hypothesis-tests-for-regression-parameters" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-tests-for-regression-parameters">Hypothesis tests for regression parameters</h3>
<ul>
<li>(see page 56)</li>
<li>Wald test, which involves calculating <span class="math inline">\Z_0</span> and using standard normal distribution often suffer from bias.</li>
<li>LRT typically performs better than the Wald Test</li>
</ul>
<p><span class="math display">H_0: \text{logit}(\pi) =
\log\left[ \frac { P( \operatorname{good} = \operatorname{1} ) }{ 1 - P( \operatorname{good} = \operatorname{1} ) } \right] = \alpha + \beta_{1}\cdot\operatorname{distance}
</span></p>
<p><span class="math display">H_A: \text{logit}(\pi) =
\log\left[ \frac { P( \operatorname{good} = \operatorname{1} ) }{ 1 - P( \operatorname{good} = \operatorname{1} ) } \right] = \alpha + \beta_{1}\cdot\operatorname{distance} + \beta_2\cdot\text{another_feature}
</span></p>
</section>
<section id="lrt" class="level3">
<h3 class="anchored" data-anchor-id="lrt">LRT</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image/LRT.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400"></p>
</figure>
</div>
<p><span class="math display">\Lambda = \frac{\text{ML under }H_0 }{\text{ML under }H_A}</span></p>
</section>
<section id="transformed-lrt" class="level3">
<h3 class="anchored" data-anchor-id="transformed-lrt">Transformed LRT</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image/transformed LRT.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400"></p>
</figure>
</div>
<p><span class="math display">-2\text{log}{(\Lambda)} \approx \chi^2</span></p>
</section>
</section>
</section>
<section id="deviance" class="level1">
<h1>Deviance</h1>
<ul>
<li><code>deviance</code> refers to the amount that a particular model deviates from another model as measured by <span class="math inline">-2\text{log}(\Lambda)</span>.</li>
</ul>
<section id="saturated-model" class="level2">
<h2 class="anchored" data-anchor-id="saturated-model">Saturated model</h2>
<ul>
<li><code>saturated model</code>, which has a different coefficent for each data point, leading to perfect prediction, a likelihood of one, and a log likelihood of zero.</li>
</ul>
</section>
<section id="null-deviance" class="level2">
<h2 class="anchored" data-anchor-id="null-deviance">Null deviance</h2>
<ul>
<li>The <code>null deviance</code> measures the performance of the worst model using only <code>an intercept</code>, providing a benchmark.</li>
</ul>
<p><span class="math display">
\text{Null Deviance}= -2 \text{log}(L(\hat{\beta_0}|y_1,..., y_n))
</span></p>
</section>
<section id="residual-deviance" class="level2">
<h2 class="anchored" data-anchor-id="residual-deviance">Residual deviance</h2>
<ul>
<li>The <code>residual deviance</code> is the deviance of our fitted model.</li>
<li>It is always greater than zero unless it is the saturated model which explains the data perfectly.</li>
</ul>
<p><span class="math display">
\text{Residual Deviance}= -2 \text{log}(L(\hat{\beta}|y_1,..., y_n))
</span></p>
<ul>
<li><p>Therefore, how much better (smaller) our <code>residual deviance</code> is compared to the <code>null deviance</code> and how close it is to zero is a measure of model fit.</p></li>
<li><p>Sometimes people will compute an <span class="math inline">R^2</span> for logistic regression using <span class="math inline">1-\frac{\text{Residual Deviance}}{\text{Null Deviance}}</span> since it is bounded between 0 (residual deviance = null deviance) and 1 (residual deviance = saturated model = 0).</p></li>
<li><p>Note that we can compute deviance of two separate models by substracting the null model residual deviance and the alternative model residual deviance from separate logistic regression fits.</p></li>
<li><p>See page 81 for more information</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mod.fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> good <span class="sc">~</span> change <span class="sc">+</span> distance , <span class="at">family =</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">binomial</span>(<span class="at">link =</span> logit), <span class="at">data =</span> placekick)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#one at a time test</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod.fit2, <span class="at">test =</span> <span class="st">"LR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: good
         LR Chisq Df Pr(&gt;Chisq)    
change      5.246  1      0.022 *  
distance  218.650  1     &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod.fit, mod.fit2, <span class="at">test =</span> <span class="st">"LR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: good ~ distance
Model 2: good ~ change + distance
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
1      1423     775.75                       
2      1422     770.50  1   5.2455    0.022 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="probability" class="level1">
<h1>Probability</h1>
<p><span class="math display">\pi_i = \frac{\text{exp}(\beta_0 + \beta_1x_{i,1}+...++ \beta_px_{i,p})}{1+\text{exp}(\beta_0 + \beta_1x_{i,1}+...++ \beta_px_{i,p})}</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>linear.pred <span class="ot">&lt;-</span> mod.fit<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mod.fit<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">20</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#value of the logit function based on given value of distance at 20</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>linear.pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   3.511547 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">distance =</span> <span class="dv">20</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod.fit, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"link"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
3.511547 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod.fit, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.9710145 </code></pre>
</div>
</div>
<section id="confidence-interval-of-the-pi-estimate" class="level2">
<h2 class="anchored" data-anchor-id="confidence-interval-of-the-pi-estimate">confidence interval of the <span class="math inline">\pi</span> estimate</h2>
<ul>
<li>see page 90</li>
<li>We can get the <span class="math inline">\hat{\pi}</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod.fit, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fit
        1 
0.9710145 

$se.fit
         1 
0.00487676 

$residual.scale
[1] 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a function to get the confidence interval of pi</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ci.pi <span class="ot">&lt;-</span> <span class="cf">function</span>(newdata , mod.fit.obj , alpha){</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  linear.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> mod.fit.obj , </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span>newdata , </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  CI.lin.pred.lower <span class="ot">&lt;-</span> linear.pred<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="at">p =</span><span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>linear.pred<span class="sc">$</span>se</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  CI.lin.pred.upper <span class="ot">&lt;-</span> linear.pred<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="at">p =</span><span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>linear.pred<span class="sc">$</span>se</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#get pi</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  CI.pi.lower <span class="ot">&lt;-</span> <span class="fu">exp</span>(CI.lin.pred.lower) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(CI.lin.pred.lower))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  CI.pi.upper <span class="ot">&lt;-</span> <span class="fu">exp</span>(CI.lin.pred.upper) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span><span class="fu">exp</span>(CI.lin.pred.upper))</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">lower =</span> CI.pi.lower , <span class="at">upper =</span> CI.pi.upper)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ci.pi</span>(<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">distance =</span> <span class="dv">20</span>), <span class="at">mod.fit.obj =</span> mod.fit , <span class="at">alpha =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$lower
        1 
0.9597647 

$upper
        1 
0.9791871 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">70</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> mod.fit , <span class="at">newdata =</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">distance =</span> x), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">ci.pi</span>(<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">distance =</span> x),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at">mod.fit.obj =</span> mod.fit , <span class="at">alpha =</span> <span class="fl">0.05</span>)<span class="sc">$</span>lower</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">ci.pi</span>(<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">distance =</span> x),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="at">mod.fit.obj =</span> mod.fit , <span class="at">alpha =</span> <span class="fl">0.05</span>)<span class="sc">$</span>upper</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(x,lower,upper,predicted)) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>x)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-5899b0c15f14409088b9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5899b0c15f14409088b9">{"x":{"data":[{"x":[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70],"y":[0.99076287056679824,0.98980527080417846,0.98874891017055655,0.9875837255068477,0.98629865529381888,0.98488154614048595,0.98331905153940302,0.98159652240436146,0.97969788888477272,0.97760553292153718,0.9753001509664313,0.97276060622434057,0.96996376968701137,0.9668843490997604,0.96349470483162336,0.95976465140340228,0.95566124317995993,0.95114854249548153,0.94618736835201489,0.94073502401091047,0.93474500265006699,0.92816667241964224,0.92094494672081495,0.91301995390521717,0.90432673497316629,0.89479502074258488,0.88434917348985276,0.87290842222887177,0.86038757052066084,0.84669839729408458,0.83175198058524036,0.81546212163710163,0.7977499116942901,0.77854927558363285,0.75781309680955733,0.73551935705253935,0.71167667017920722,0.68632866189035024,0.65955679000714529,0.63148135216913692,0.60226055163484848,0.57208759206088011,0.54118587261964346,0.50980247354334052,0.47820025766114577,0.44664904640628789,0.41541643169533643,0.38475883336420769,0.35491339155009927,0.32609119494507477,0.29847220323094137,0.27220204870550924,0.24739072507036874,0.22411301500582637,0.20241038999266253,0.18229404430746607,0.16374869994603319,0.14673683345881222,0.13120301851871302,0.11707813764547434,0.10428328214896239,0.092733222671969831,0.082339388179894057,0.073012335979471377,0.064663728594730338,0.05720785580024465],"text":["x:  5<br />value: 0.99076287<br />name: lower","x:  6<br />value: 0.98980527<br />name: lower","x:  7<br />value: 0.98874891<br />name: lower","x:  8<br />value: 0.98758373<br />name: lower","x:  9<br />value: 0.98629866<br />name: lower","x: 10<br />value: 0.98488155<br />name: lower","x: 11<br />value: 0.98331905<br />name: lower","x: 12<br />value: 0.98159652<br />name: lower","x: 13<br />value: 0.97969789<br />name: lower","x: 14<br />value: 0.97760553<br />name: lower","x: 15<br />value: 0.97530015<br />name: lower","x: 16<br />value: 0.97276061<br />name: lower","x: 17<br />value: 0.96996377<br />name: lower","x: 18<br />value: 0.96688435<br />name: lower","x: 19<br />value: 0.96349470<br />name: lower","x: 20<br />value: 0.95976465<br />name: lower","x: 21<br />value: 0.95566124<br />name: lower","x: 22<br />value: 0.95114854<br />name: lower","x: 23<br />value: 0.94618737<br />name: lower","x: 24<br />value: 0.94073502<br />name: lower","x: 25<br />value: 0.93474500<br />name: lower","x: 26<br />value: 0.92816667<br />name: lower","x: 27<br />value: 0.92094495<br />name: lower","x: 28<br />value: 0.91301995<br />name: lower","x: 29<br />value: 0.90432673<br />name: lower","x: 30<br />value: 0.89479502<br />name: lower","x: 31<br />value: 0.88434917<br />name: lower","x: 32<br />value: 0.87290842<br />name: lower","x: 33<br />value: 0.86038757<br />name: lower","x: 34<br />value: 0.84669840<br />name: lower","x: 35<br />value: 0.83175198<br />name: lower","x: 36<br />value: 0.81546212<br />name: lower","x: 37<br />value: 0.79774991<br />name: lower","x: 38<br />value: 0.77854928<br />name: lower","x: 39<br />value: 0.75781310<br />name: lower","x: 40<br />value: 0.73551936<br />name: lower","x: 41<br />value: 0.71167667<br />name: lower","x: 42<br />value: 0.68632866<br />name: lower","x: 43<br />value: 0.65955679<br />name: lower","x: 44<br />value: 0.63148135<br />name: lower","x: 45<br />value: 0.60226055<br />name: lower","x: 46<br />value: 0.57208759<br />name: lower","x: 47<br />value: 0.54118587<br />name: lower","x: 48<br />value: 0.50980247<br />name: lower","x: 49<br />value: 0.47820026<br />name: lower","x: 50<br />value: 0.44664905<br />name: lower","x: 51<br />value: 0.41541643<br />name: lower","x: 52<br />value: 0.38475883<br />name: lower","x: 53<br />value: 0.35491339<br />name: lower","x: 54<br />value: 0.32609119<br />name: lower","x: 55<br />value: 0.29847220<br />name: lower","x: 56<br />value: 0.27220205<br />name: lower","x: 57<br />value: 0.24739073<br />name: lower","x: 58<br />value: 0.22411302<br />name: lower","x: 59<br />value: 0.20241039<br />name: lower","x: 60<br />value: 0.18229404<br />name: lower","x: 61<br />value: 0.16374870<br />name: lower","x: 62<br />value: 0.14673683<br />name: lower","x: 63<br />value: 0.13120302<br />name: lower","x: 64<br />value: 0.11707814<br />name: lower","x: 65<br />value: 0.10428328<br />name: lower","x: 66<br />value: 0.09273322<br />name: lower","x: 67<br />value: 0.08233939<br />name: lower","x: 68<br />value: 0.07301234<br />name: lower","x: 69<br />value: 0.06466373<br />name: lower","x: 70<br />value: 0.05720786<br />name: lower"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"lower","legendgroup":"lower","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70],"y":[0.99471164922510558,0.99407080393077707,0.99335281959757493,0.99254854407940707,0.99164777347560074,0.99063914000822284,0.98950999021366781,0.98824625322616932,0.98683229912338943,0.98525078756606232,0.98348250731102105,0.98150620762850904,0.97929842323163585,0.9768332950514933,0.97408239009063047,0.97101452468547556,0.96759559682855767,0.96378843476334353,0.9595526708791865,0.95484465199844026,0.94961739943837575,0.94382063469313415,0.93740088912046671,0.93030171848583332,0.92246404539741722,0.91382665426612253,0.90432686406426566,0.89390140336750712,0.88248750940281417,0.87002426750147321,0.85645419889026708,0.84172509265984763,0.82579206175169761,0.80861978298310211,0.79018485807496552,0.77047820761041574,0.74950738483790358,0.72729867399869752,0.70389882176684149,0.67937624407260666,0.65382155742140746,0.62734730628766056,0.60008679710568447,0.5721920034362874,0.54383057219393638,0.51518203116592087,0.4864333655687097,0.45777418767860129,0.42939176115278849,0.40146615530677976,0.37416579240088593,0.34764361464345289,0.32203404219534421,0.29745082635647091,0.27398583170825602,0.2517087152119668,0.23066741544772587,0.21088932532778137,0.19238299822803112,0.17514022981580582,0.15913836351362801,0.14434268317769253,0.13070877855189603,0.11818479399595772,0.10671349608226184,0.096234118861999562],"text":["x:  5<br />value: 0.99471165<br />name: predicted","x:  6<br />value: 0.99407080<br />name: predicted","x:  7<br />value: 0.99335282<br />name: predicted","x:  8<br />value: 0.99254854<br />name: predicted","x:  9<br />value: 0.99164777<br />name: predicted","x: 10<br />value: 0.99063914<br />name: predicted","x: 11<br />value: 0.98950999<br />name: predicted","x: 12<br />value: 0.98824625<br />name: predicted","x: 13<br />value: 0.98683230<br />name: predicted","x: 14<br />value: 0.98525079<br />name: predicted","x: 15<br />value: 0.98348251<br />name: predicted","x: 16<br />value: 0.98150621<br />name: predicted","x: 17<br />value: 0.97929842<br />name: predicted","x: 18<br />value: 0.97683330<br />name: predicted","x: 19<br />value: 0.97408239<br />name: predicted","x: 20<br />value: 0.97101452<br />name: predicted","x: 21<br />value: 0.96759560<br />name: predicted","x: 22<br />value: 0.96378843<br />name: predicted","x: 23<br />value: 0.95955267<br />name: predicted","x: 24<br />value: 0.95484465<br />name: predicted","x: 25<br />value: 0.94961740<br />name: predicted","x: 26<br />value: 0.94382063<br />name: predicted","x: 27<br />value: 0.93740089<br />name: predicted","x: 28<br />value: 0.93030172<br />name: predicted","x: 29<br />value: 0.92246405<br />name: predicted","x: 30<br />value: 0.91382665<br />name: predicted","x: 31<br />value: 0.90432686<br />name: predicted","x: 32<br />value: 0.89390140<br />name: predicted","x: 33<br />value: 0.88248751<br />name: predicted","x: 34<br />value: 0.87002427<br />name: predicted","x: 35<br />value: 0.85645420<br />name: predicted","x: 36<br />value: 0.84172509<br />name: predicted","x: 37<br />value: 0.82579206<br />name: predicted","x: 38<br />value: 0.80861978<br />name: predicted","x: 39<br />value: 0.79018486<br />name: predicted","x: 40<br />value: 0.77047821<br />name: predicted","x: 41<br />value: 0.74950738<br />name: predicted","x: 42<br />value: 0.72729867<br />name: predicted","x: 43<br />value: 0.70389882<br />name: predicted","x: 44<br />value: 0.67937624<br />name: predicted","x: 45<br />value: 0.65382156<br />name: predicted","x: 46<br />value: 0.62734731<br />name: predicted","x: 47<br />value: 0.60008680<br />name: predicted","x: 48<br />value: 0.57219200<br />name: predicted","x: 49<br />value: 0.54383057<br />name: predicted","x: 50<br />value: 0.51518203<br />name: predicted","x: 51<br />value: 0.48643337<br />name: predicted","x: 52<br />value: 0.45777419<br />name: predicted","x: 53<br />value: 0.42939176<br />name: predicted","x: 54<br />value: 0.40146616<br />name: predicted","x: 55<br />value: 0.37416579<br />name: predicted","x: 56<br />value: 0.34764361<br />name: predicted","x: 57<br />value: 0.32203404<br />name: predicted","x: 58<br />value: 0.29745083<br />name: predicted","x: 59<br />value: 0.27398583<br />name: predicted","x: 60<br />value: 0.25170872<br />name: predicted","x: 61<br />value: 0.23066742<br />name: predicted","x: 62<br />value: 0.21088933<br />name: predicted","x: 63<br />value: 0.19238300<br />name: predicted","x: 64<br />value: 0.17514023<br />name: predicted","x: 65<br />value: 0.15913836<br />name: predicted","x: 66<br />value: 0.14434268<br />name: predicted","x: 67<br />value: 0.13070878<br />name: predicted","x: 68<br />value: 0.11818479<br />name: predicted","x: 69<br />value: 0.10671350<br />name: predicted","x: 70<br />value: 0.09623412<br />name: predicted"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,186,56,1)","dash":"solid"},"hoveron":"points","name":"predicted","legendgroup":"predicted","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70],"y":[0.99697751497811637,0.99655782016333616,0.99608029261845721,0.99553708288528242,0.99491930932454908,0.99421693185550253,0.99341861304427281,0.99251156615126968,0.99148139006607494,0.9903118915169099,0.98898489558205793,0.98748004640298492,0.98577460116323412,0.98384322192255369,0.98165777185807435,0.97918712494090843,0.97639700113449646,0.97324984287711236,0.96970475287645241,0.96571751794850402,0.96124074841649165,0.95622416675607635,0.9506150815430866,0.94435908147536129,0.93740097667403255,0.929685997366411,0.92116123024125107,0.91177722886612211,0.90148967993170881,0.89026095347116541,0.87806133456061231,0.86486975421993895,0.85067392785077234,0.83546996110979344,0.81926164555633285,0.80205976559714276,0.78388172007681645,0.76475163186214179,0.74470094012293953,0.72376932012614681,0.70200570006028462,0.67946914425995775,0.65622941980129956,0.63236712799535622,0.60797334365944133,0.58314875519643294,0.55800233703680502,0.53264961517837794,0.50721060851319111,0.48180754437492834,0.45656245633720033,0.43159477539126523,0.40701902199134343,0.38294269630002858,0.35946444812599204,0.33667258791963994,0.31464397757517998,0.29344331663154444,0.27312281762595536,0.25372224537857774,0.23526927996609109,0.21778015265141532,0.20126049815269687,0.18570636501311788,0.17110532782567897,0.1574376498489968],"text":["x:  5<br />value: 0.99697751<br />name: upper","x:  6<br />value: 0.99655782<br />name: upper","x:  7<br />value: 0.99608029<br />name: upper","x:  8<br />value: 0.99553708<br />name: upper","x:  9<br />value: 0.99491931<br />name: upper","x: 10<br />value: 0.99421693<br />name: upper","x: 11<br />value: 0.99341861<br />name: upper","x: 12<br />value: 0.99251157<br />name: upper","x: 13<br />value: 0.99148139<br />name: upper","x: 14<br />value: 0.99031189<br />name: upper","x: 15<br />value: 0.98898490<br />name: upper","x: 16<br />value: 0.98748005<br />name: upper","x: 17<br />value: 0.98577460<br />name: upper","x: 18<br />value: 0.98384322<br />name: upper","x: 19<br />value: 0.98165777<br />name: upper","x: 20<br />value: 0.97918712<br />name: upper","x: 21<br />value: 0.97639700<br />name: upper","x: 22<br />value: 0.97324984<br />name: upper","x: 23<br />value: 0.96970475<br />name: upper","x: 24<br />value: 0.96571752<br />name: upper","x: 25<br />value: 0.96124075<br />name: upper","x: 26<br />value: 0.95622417<br />name: upper","x: 27<br />value: 0.95061508<br />name: upper","x: 28<br />value: 0.94435908<br />name: upper","x: 29<br />value: 0.93740098<br />name: upper","x: 30<br />value: 0.92968600<br />name: upper","x: 31<br />value: 0.92116123<br />name: upper","x: 32<br />value: 0.91177723<br />name: upper","x: 33<br />value: 0.90148968<br />name: upper","x: 34<br />value: 0.89026095<br />name: upper","x: 35<br />value: 0.87806133<br />name: upper","x: 36<br />value: 0.86486975<br />name: upper","x: 37<br />value: 0.85067393<br />name: upper","x: 38<br />value: 0.83546996<br />name: upper","x: 39<br />value: 0.81926165<br />name: upper","x: 40<br />value: 0.80205977<br />name: upper","x: 41<br />value: 0.78388172<br />name: upper","x: 42<br />value: 0.76475163<br />name: upper","x: 43<br />value: 0.74470094<br />name: upper","x: 44<br />value: 0.72376932<br />name: upper","x: 45<br />value: 0.70200570<br />name: upper","x: 46<br />value: 0.67946914<br />name: upper","x: 47<br />value: 0.65622942<br />name: upper","x: 48<br />value: 0.63236713<br />name: upper","x: 49<br />value: 0.60797334<br />name: upper","x: 50<br />value: 0.58314876<br />name: upper","x: 51<br />value: 0.55800234<br />name: upper","x: 52<br />value: 0.53264962<br />name: upper","x: 53<br />value: 0.50721061<br />name: upper","x: 54<br />value: 0.48180754<br />name: upper","x: 55<br />value: 0.45656246<br />name: upper","x: 56<br />value: 0.43159478<br />name: upper","x: 57<br />value: 0.40701902<br />name: upper","x: 58<br />value: 0.38294270<br />name: upper","x: 59<br />value: 0.35946445<br />name: upper","x: 60<br />value: 0.33667259<br />name: upper","x: 61<br />value: 0.31464398<br />name: upper","x: 62<br />value: 0.29344332<br />name: upper","x: 63<br />value: 0.27312282<br />name: upper","x: 64<br />value: 0.25372225<br />name: upper","x: 65<br />value: 0.23526928<br />name: upper","x: 66<br />value: 0.21778015<br />name: upper","x: 67<br />value: 0.20126050<br />name: upper","x: 68<br />value: 0.18570637<br />name: upper","x: 69<br />value: 0.17110533<br />name: upper","x: 70<br />value: 0.15743765<br />name: upper"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(97,156,255,1)","dash":"solid"},"hoveron":"points","name":"upper","legendgroup":"upper","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.75,73.25],"tickmode":"array","ticktext":["20","40","60"],"tickvals":[20,40,60],"categoryorder":"array","categoryarray":["20","40","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"x","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.010219372841351063,1.0439659979370099],"tickmode":"array","ticktext":["0.25","0.50","0.75","1.00"],"tickvals":[0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"value","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"name","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6207f64c2d":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"6207f64c2d","visdat":{"6207f64c2d":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="odds" class="level1">
<h1>ODDS</h1>
<ul>
<li><p>see page 83, the odd of success at a particular value of <code>x</code></p></li>
<li><p>The following model can be used to estimate the odd at specific value of <code>x</code></p></li>
</ul>
<p><span class="math display">\text{Odds}_x = \text{exp}(\beta_0 + \beta_1x)</span></p>
<ul>
<li>The following model can be used to estimate the odd at specific value of <code>x + c</code></li>
</ul>
<p><span class="math display">\text{Odds}_{x+c} = \text{exp}(\beta_0 + \beta_1(x+c)</span><br>
</p>
<section id="odd-ratio" class="level2">
<h2 class="anchored" data-anchor-id="odd-ratio">ODD Ratio</h2>
<p><span class="math display">\text{OR} = \frac{\text{Odds}_{x+c}}{\text{Odds}_{x}}= \text{exp}(c\beta_1)</span> -</p>
<ul>
<li>Increase in odd is <code>OR</code> &gt; 1,</li>
<li>decrease in odd if <code>OR</code> &lt; 1,</li>
</ul>
<p><span class="math display">\hat{\text{OR}} = \text{exp}(c\hat{\beta}_1)</span> - So, it will have estimated variance. - As you have guessed by now, Wald CI does not work well when sample size small.</p>
<ul>
<li>use <code>transformed LRT</code> statistic.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#finds LR confidence interval</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>mod.fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = good ~ distance, family = binomial(link = logit), 
    data = placekick)

Coefficients:
(Intercept)     distance  
      5.812       -0.115  

Degrees of Freedom: 1424 Total (i.e. Null);  1423 Residual
Null Deviance:      1013 
Residual Deviance: 775.7    AIC: 779.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>beta.ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(mod.fit, <span class="at">parm =</span> <span class="st">"distance"</span>, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>beta.ci</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %      97.5 % 
-0.13181435 -0.09907103 </code></pre>
</div>
</div>
<section id="understanding-the-changes-in-odd" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-changes-in-odd">Understanding the changes in odd</h3>
<ul>
<li><code>10-yard</code> decrease in <code>distance</code> increases the odds of a successful placekick.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  97.5 %    2.5 % 
2.693147 3.736478 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.682701 3.719946</code></pre>
</div>
</div>
<ul>
<li>Has similar interval due to large sample size</li>
</ul>
</section>
<section id="example-of-magin-coin" class="level3">
<h3 class="anchored" data-anchor-id="example-of-magin-coin">Example of magin coin</h3>
<ul>
<li><p>You can convert log odd to probability</p></li>
<li><p>Your aunt offers a service in which she weights coins to make them unfair.</p></li>
<li><p>You give her a coin and tell her how much you want the <code>log-odds</code> to change.</p>
<ul>
<li>She returns the modified coin.</li>
</ul></li>
<li><p>For each of the following orders, use your function to compute the resulting probability of heads:</p>
<ul>
<li>fair coin, increase log-odds by 1.</li>
<li>fair coin, increase log-odds by 2.</li>
<li>fair coin, increase log-odds by 10.</li>
<li>fair coin, decrease log-odds by 1.</li>
<li>fair coin, decrease log-odds by 2.</li>
<li>fair coin, decrease log-odds by 10.</li>
</ul></li>
<li><p>Write an R function that computes the <code>probability of heads</code>, given log-odds.</p></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">log_odds</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.881</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.731</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.500</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0.269</td>
</tr>
<tr class="even">
<td style="text-align: right;">-2</td>
<td style="text-align: right;">0.119</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-10</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>


</div>
</div>
<ul>
<li>In you own words, describe how changes in log-odds translate to changes in probability</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>You can see in this plot, As log-odds increase, the probability of success increases relative to the probability of failure, and it approaches one. As log-odds decrease probability of success decrease and converges to zero.</p></li>
<li><p>If you get log-odds values that are very very small like -10 the probability of success is almost zero, and if you get log-odds values that are very big like 10 or the probability of success is almost one.</p></li>
<li><p>The relationship between log-odd and probability is not linear, but of s-curve type, and log odds ratios ranging from -5 to +5 create probabilities that range from just above 0 to very close to 1.</p></li>
</ul>
</section>
</section>
</section>
<section id="case-study-south-african-heart-disease" class="level1">
<h1>Case Study: South African Heart Disease</h1>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<ul>
<li><p>Target: <code>Probability of getting coronary heart disease</code>, <code>chd</code></p></li>
<li><p>Feature:</p>
<ul>
<li>High blood pressure, high LDL cholesterol, diabetes, smoking, secondhand smoke exposure, obesity, an unhealthy diet, and physical inactivity are among the leading risk factors for heart disease.</li>
</ul></li>
<li><p>Data Source: Source: Rousseauw, J., du Plessis, J., Benade, A., Jordaan, P., Kotze, J. and Ferreira, J. (1983). Coronary risk factor screening in three rural communities, South African Medical Journal 64: 430–436.</p></li>
<li><p><code>Data Description</code></p>
<ul>
<li>sbp: systolic blood pressure</li>
<li>tobacco: cumulative tobacco use (kg)</li>
<li>ldl: low density lipoprotein cholesterol (‘bad’ cholestrol)</li>
<li>adiposity: Body adiposity index determines body fat percentage(calculated as (HC / (HM)1.5) - 18, where HC = Hip Circumference in Centimetres and HM = Height in meters)</li>
<li>famhist: family history of heart disease</li>
<li>typea: A personality type that could raise one’s chances of developing coronary heart disease</li>
<li>obesity: Body Mass Index (BMI) (<span class="math inline">kg/m^2</span>)</li>
<li>alcohol: current alcohol consumption</li>
<li>age: age at onset</li>
<li><code>chd</code>: coronary heart disease (<code>target</code>)</li>
</ul></li>
</ul>
</section>
<section id="task" class="level2">
<h2 class="anchored" data-anchor-id="task">Task</h2>
<ul>
<li><p>Using <code>blood pressure</code>, <code>smoking</code>, <code>cholesterol</code>,and <code>age</code>.</p></li>
<li><p>Load the data and answer the following questions:</p>
<ul>
<li><code>What are the number of variables and number of observations?</code></li>
<li><code>What is the type of each variable? Do we need to change it?</code></li>
<li><code>Are there any missing values (in each of the variables)?</code></li>
<li><code>Are there any abnormal values in each of the variables in the     raw data?</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">tobacco</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ldl</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sbp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chd</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">obesity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">12.00</td>
<td style="text-align: right;">5.73</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">25.30</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">4.41</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">28.87</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">3.48</td>
<td style="text-align: right;">118</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">29.14</td>
</tr>
<tr class="even">
<td style="text-align: right;">7.50</td>
<td style="text-align: right;">6.41</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">31.99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13.60</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">25.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.20</td>
<td style="text-align: right;">6.47</td>
<td style="text-align: right;">132</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30.77</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">EDA</h2>
<ul>
<li><p>Univariate analysis</p>
<ul>
<li><p>The response (or dependent) variable of interest, Heart disease, is a binary variable taking the type factor.</p></li>
<li><p>Use a bar chart to explore the distribution of the response variable (<code>chd</code>). What do you learn?</p></li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Heart disease</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">302</td>
<td style="text-align: right;">0.65</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">0.35</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For metric variables, a density plot or histogram allows us to determine the shape of the distribution and look for outliers.</p>
<ul>
<li>Use a density plot to explore the distribution of explanatory variables. What do you discover?</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p><code>Bivariate Analysis</code></p>
<ul>
<li><p>Prior to moving on to the fully specified model, it is advisable to first examine the simple associations between the response and each explanatory variable.</p></li>
<li><p><code>Box plots</code> are useful for exploring the association between a categorical variable and a variable measured on an interval scale.</p></li>
<li><p>Use a <code>boxplot</code> to examine how the explanatory variables are correlated with the response variable (chd)?</p>
<ul>
<li>The <code>coord_flip()</code> function is used to keep the dependent variable on the y-axis.</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Use the convenient summary_factorlist() function from the finalfit package to tabulate data.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Dependent: chd</th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">0</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ldl</td>
<td style="text-align: left;">Mean (SD)</td>
<td style="text-align: left;">4.3 (1.9)</td>
<td style="text-align: left;">5.5 (2.2)</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sbp</td>
<td style="text-align: left;">Mean (SD)</td>
<td style="text-align: left;">135.5 (18.0)</td>
<td style="text-align: left;">143.7 (23.7)</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tobacco</td>
<td style="text-align: left;">Mean (SD)</td>
<td style="text-align: left;">2.6 (3.6)</td>
<td style="text-align: left;">5.5 (5.6)</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: left;">Mean (SD)</td>
<td style="text-align: left;">38.9 (14.9)</td>
<td style="text-align: left;">50.3 (10.6)</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
</tbody>
</table>


</div>
</div>
<ul>
<li>According to the plots and the tables, What variable is most important for explaining heart disease? How is that variable correlated with heart disease?</li>
</ul>
</section>
<section id="mrl" class="level2">
<h2 class="anchored" data-anchor-id="mrl">MRL</h2>
<ul>
<li><p>Is the linear probability model an appropriate choice to study the relationship between heart disease and risk factors?</p></li>
<li><p>Estimate the following linear probability model and interpret the model results.</p></li>
</ul>
<p><span class="math display">\text{chd} = \beta_0 + \beta_1 \cdot \text{ldl} + \beta_2 \cdot \text{sbp} + + \beta_3 \cdot \text{tobacco} + \beta_4 \cdot \text{age} + \epsilon</span></p>
<p><span class="math display">
\operatorname{\hat{chd}} = -0.35 + 0.036\cdot\operatorname{ldl} + 0.00097\cdot\operatorname{sbp} + 0.0165 \cdot\operatorname{tobacco} + 0.007 \cdot \operatorname{age} + \hat{\epsilon}
</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = chd ~ ldl + sbp + tobacco + age, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.8439 -0.3405 -0.1250  0.4365  1.0172 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.3493578  0.1405912  -2.485 0.013315 *  
ldl          0.0362419  0.0102322   3.542 0.000438 ***
sbp          0.0009739  0.0010670   0.913 0.361839    
tobacco      0.0165577  0.0049101   3.372 0.000809 ***
age          0.0076831  0.0016886   4.550 6.89e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4318 on 457 degrees of freedom
Multiple R-squared:  0.1853,    Adjusted R-squared:  0.1781 
F-statistic: 25.98 on 4 and 457 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ul>
<li>What are the advantages and disadvantages of the linear probability model?</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="glm" class="level2">
<h2 class="anchored" data-anchor-id="glm">GLM</h2>
<ul>
<li>Generalized linear model</li>
<li>Estimate the following logistic regression model and interpret the model results.</li>
</ul>
<p><span class="math display"> \text{logit}(\pi_i) =\beta_0 + \beta_1 \cdot \text{ldl} + \beta_2 \cdot \text{sbp} + + \beta_3 \cdot \text{tobacco} + \beta_4 \cdot \text{age} +  \epsilon</span></p>
<p><span class="math display">
\log\left[ \frac { P( \operatorname{chd} = \operatorname{1} ) }{ 1 - P( \operatorname{chd} = \operatorname{1} ) } \right] = -4.54 + 0.018\cdot \operatorname{ldl} + 0.004\cdot \operatorname{sbp} + 0.075\cdot \operatorname{tobacco} + 0.04\cdot \operatorname{age}
</span></p>
<section id="odd-ratio-1" class="level3">
<h3 class="anchored" data-anchor-id="odd-ratio-1">Odd ratio</h3>
<ul>
<li>Do the <code>raw</code> coefficient estimates <code>directionally make sense</code>?</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ ldl + sbp + tobacco + age, family = binomial(link = logit), 
    data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9457  -0.8595  -0.4999   1.0238   2.3906  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -4.535524   0.781360  -5.805 6.45e-09 ***
ldl          0.185131   0.054121   3.421 0.000625 ***
sbp          0.004307   0.005394   0.798 0.424623    
tobacco      0.075982   0.025616   2.966 0.003016 ** 
age          0.046264   0.009852   4.696 2.66e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 596.11  on 461  degrees of freedom
Residual deviance: 502.19  on 457  degrees of freedom
AIC: 512.19

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<ul>
<li><blockquote class="blockquote">
<p><strong>Again, all of the explanatory variables except blood pressure are statistically significant and positively correlated with the probability of heart disease, same as the linear probability model.</strong></p>
</blockquote></li>
<li>Recall that (page 83)</li>
</ul>
<p><span class="math display">
\text{OR} = \frac{\text{Odds}_{x_k+c}}{\text{Odds}_{x_k}}=exp(c \beta_k)
</span></p>
<ul>
<li><p>The odd of a success change by exp(c<span class="math inline">\beta_k</span>) <code>times</code> for every c-unit increase in x</p></li>
<li><p>Compute and interpret the estimated odds ratio for a 10-unit increase in each explanatory variable.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace with your code</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">exp</span>(<span class="dv">10</span><span class="sc">*</span><span class="fu">coef</span>(mod.logit.h0)),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         ldl         sbp     tobacco         age 
       0.00        6.37        1.04        2.14        1.59 </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>The estimated odds of success or having a heart disease change by 6.37 times for every 10-unit increase in LDL or ‘bad’ cholesterol.</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Interestingly, the odds of having a heart disease is almost 1 for every 10-unit increase in blood pressure, which means an increase in blood pressure doesn’t change the odds of having heart disease, and it’s consistent with its insignificant coefficient.</strong></p>
</blockquote>
</section>
<section id="hypothesis-test" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-test">Hypothesis Test</h3>
<ul>
<li><p>Using the likelihood ratio test (LRT) for hypothesis testing is a common practice in a logistic regression model.</p></li>
<li><p>Use LRT to test whether (<span class="math inline">obesity</span>) is associated with heart disease.</p>
<ul>
<li><p><span class="math inline">H_0: \beta_{obesity} = 0</span></p></li>
<li><p><span class="math inline">H_a: \beta_{obesity} \ne 0</span></p></li>
</ul></li>
</ul>
<p>Use both <em>Anova()</em> or <em>anova()</em> functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mod.logit.ha &lt;- # uncomment and replace with your code</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>mod.logit.ha <span class="ot">&lt;-</span> <span class="fu">glm</span>(chd <span class="sc">~</span> ldl <span class="sc">+</span> sbp <span class="sc">+</span>tobacco <span class="sc">+</span> age <span class="sc">+</span> obesity, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> logit), <span class="at">data =</span> df)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#anova()</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod.logit.h0, mod.logit.ha, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: chd ~ ldl + sbp + tobacco + age
Model 2: chd ~ ldl + sbp + tobacco + age + obesity
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1       457     502.19                     
2       456     501.07  1   1.1191   0.2901</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Anova()</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod.logit.ha, <span class="at">test =</span> <span class="st">"LR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: chd
        LR Chisq Df Pr(&gt;Chisq)    
ldl      13.3932  1  0.0002525 ***
sbp       0.8640  1  0.3526279    
tobacco   9.4670  1  0.0020920 ** 
age      24.3447  1  8.055e-07 ***
obesity   1.1191  1  0.2901078    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ul>
<li><p><code>deviance</code> refers to the amount that a particular model deviates from another model as measured by <span class="math inline">-2\text{log}(\Lambda)</span>.</p></li>
<li><p>What are the null deviance and residual deviance in the model summary?</p>
<ul>
<li>For <code>null</code> and <code>residual deviance</code>, the alternative model we use is the <code>saturated model</code>, which has a different coefficent for each data point, leading to perfect prediction, a likelihood of one, and a log likelihood of zero.</li>
</ul></li>
<li><p>The <code>null deviance</code> measures the performance of the worst model using only <code>an intercept</code>, providing a benchmark.</p></li>
</ul>
<p><span class="math display">
\text{Null Deviance}= -2 \text{log}(L(\hat{\beta_0}|y_1,..., y_n))
</span></p>
<ul>
<li>The <code>residual deviance</code> is the deviance of our fitted model.
<ul>
<li>It is always greater than zero unless it is the saturated model / explains the data perfectly.</li>
</ul></li>
</ul>
<p><span class="math display">
\text{Residual Deviance}= -2 \text{log}(L(\hat{\beta}|y_1,..., y_n))
</span></p>
<ul>
<li><p>Therefore, how much better (smaller) our residual deviance is compared to the null deviance and how close it is to zero is a measure of model fit.</p></li>
<li><p>Sometimes people will compute an <span class="math inline">R^2</span> for logistic regression using <span class="math inline">1-\frac{\text{Residual Deviance}}{\text{Null Deviance}}</span> since it is bounded between 0 (residual deviance = null deviance) and 1 (residual deviance = saturated model = 0).</p></li>
<li><p>Note that we can compute deviance of two separate models by substracting the null model residual deviance and the alternative model residual deviance from separate logistic regression fits. (Why is this?)</p></li>
<li><p>Using deviance, test whether (<span class="math inline">obesity</span>) is associated with heart disease.</p>
<ul>
<li><p><span class="math inline">H_0: \beta_{obesity} = 0</span></p></li>
<li><p><span class="math inline">H_a: \beta_{obesity} \ne 0</span></p></li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p><strong>We get a p-value of 0.29, the same as what we got from both anova() and Anova() functions, and again we fail to reject the null hypothesis that obesity is not correlated with heart disease given this data set.</strong></p>
</blockquote>
</section>
<section id="confidence-interval" class="level3">
<h3 class="anchored" data-anchor-id="confidence-interval">Confidence Interval</h3>
<ul>
<li>Confidence Interval for <code>odds ratio</code></li>
</ul>
<p><strong>Wald Confidence:</strong></p>
<p><span class="math display">
c*\hat{\beta_k} \pm c*Z_{1-\alpha/2} \sqrt{\widehat{Var}(\hat{\beta}_k)}
</span></p>
<p><span class="math display">
exp \left(c*\hat{\beta_k} \pm c*Z_{1-\alpha/2} \sqrt{\widehat{Var}(\hat{\beta}_k)} \right)
</span></p>
<ul>
<li>Calculate Wald CI for odds ratio of 10-unit increase in LDL cholesterol based on the above formula:</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>             (Intercept)           ldl           sbp       tobacco
(Intercept)  0.610523787 -9.955527e-03 -3.315082e-03  1.122271e-03
ldl         -0.009955527  2.929029e-03 -1.336470e-05 -4.923675e-06
sbp         -0.003315082 -1.336470e-05  2.909849e-05 -1.506782e-06
tobacco      0.001122271 -4.923675e-06 -1.506782e-06  6.562050e-04
age         -0.001828353 -6.178475e-05 -1.503794e-05 -7.699037e-05
                      age
(Intercept) -1.828353e-03
ldl         -6.178475e-05
sbp         -1.503794e-05
tobacco     -7.699037e-05
age          9.706566e-05</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2.20 18.39</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>With 95% confidence, the odds of having a heart disease change between 2.20 to 18.4 times for every 10-unit increase in LDL or ‘bad’ cholesterol.</strong></p>
</blockquote>
<ul>
<li>What is the main concern with Wald CI?</li>
</ul>
<blockquote class="blockquote">
<p><strong>Wald confidence interval has a true confidence level close to the 95% only when we have large samples. When the sample size is not large, profile LR confidence intervals generally perform better.</strong></p>
</blockquote>
<ul>
<li>Now calculate the <em>profile likelihood ratio (LR)</em> confidence interval using the confint function.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace with your code</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>beta_ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(mod.logit.h0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>odds_ci <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="dv">10</span><span class="sc">*</span>beta_ci)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(odds_ci ),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            2.5 % 97.5 %
(Intercept)  0.00   0.00
ldl          2.24  18.84
sbp          0.94   1.16
tobacco      1.31   3.59
age          1.31   1.93</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Since we have a large sample, 462 observations, the profile likelihood ratio (LR) confidence interval is pretty close to the Wald CI.</strong></p>
</blockquote>
<ul>
<li><p><code>Confidence Interval for the Probability of Success</code></p></li>
<li><p>Recall that the estimated probability of success is <span class="math display">
\hat{\pi} = \frac{exp \left( \hat{\beta}_0 + \hat{\beta}_1 x_1 + \dots + \hat{\beta}_K x_k \right)}{1+exp \left(\hat{\beta}_0 + \hat{\beta}_1 x_1 + \dots + \hat{\beta}_K x_k \right)}
</span></p></li>
</ul>
<p>While backing out the estimated probability of success is straightforward, obtaining its confidence interval is not, as it involves many parameters.</p>
<p><strong>Wald Confidence Interval</strong></p>
<p><span class="math display">
\hat{\beta}_0 + \hat{\beta}_1 x_1 + \dots + \hat{\beta}_K x_K \pm Z_{1-\alpha/2} \sqrt{\widehat{Var}(\hat{\beta}_0 + \hat{\beta}_1 x_1 + \dots + \hat{\beta}_K x_K)}
</span></p>
<p>where</p>
<p><span class="math display">
\widehat{Var}(\hat{\beta}_0 + \hat{\beta}_1 x_1 + \dots + \hat{\beta}_K x_K) = \sum_{i=0}^K x_i^2 \widehat{Var}(\hat{\beta_i}) + 2 \sum_{i=0}^{K-1} \sum_{j=i+1}^{K} x_i x_j \widehat{Cov}(\hat{\beta}_i,\hat{\beta}_j)
</span></p>
<p>So, the Wald Interval for <span class="math inline">\pi</span> is</p>
<p><span class="math display">
\frac{exp \left( \hat{\beta}_0 + \hat{\beta}_1 x_1 + \dots + \hat{\beta}_K x_k \pm \sqrt{\sum_{i=0}^K x_i^2 \widehat{Var}(\hat{\beta_i}) + 2 \sum_{i=0}^{K-1} \sum_{j=i+1}^{K} x_i x_j \widehat{Cov}(\hat{\beta}_i,\hat{\beta}_j)}  \right)}{1+exp \left(\hat{\beta}_0 + \hat{\beta}_1 x_1 + \dots + \hat{\beta}_K x_k \right)  \pm \sqrt{\sum_{i=0}^K x_i^2 \widehat{Var}(\hat{\beta_i}) + 2 \sum_{i=0}^{K-1} \sum_{j=i+1}^{K} x_i x_j \widehat{Cov}(\hat{\beta}_i,\hat{\beta}_j)}}
</span></p>
<ul>
<li>For an average value of all explanatory variables, compute the Confidence Interval for the Probability of Success given the formula above</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  pi.hat  lower  upper
1 0.3089 0.2925 0.3259</code></pre>
</div>
</div>
</section>
</section>
<section id="final-visualization" class="level2">
<h2 class="anchored" data-anchor-id="final-visualization">Final Visualization</h2>
<ul>
<li><p>Using both the linear probability and logistic regression models, plot the estimated probability of heart disease for different values of cholesterol, holding other variables constant at their average level.</p></li>
<li><p>Discuss which one can better explain this relationship.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="final-report" class="level2">
<h2 class="anchored" data-anchor-id="final-report">Final Report</h2>
<ul>
<li>Display both estimated linear and logistic models in a regression table. Is there any significant difference between their results?</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Table 1: The estimated relationship between heart disease and risk factors
==================================================
                         Dependent variable:      
                    ------------------------------
                                 chd              
                           OLS          logistic  
                           (1)             (2)    
--------------------------------------------------
ldl                      0.036***       0.185***  
                         (0.010)         (0.054)  
                                                  
sbp                       0.001           0.004   
                         (0.001)         (0.005)  
                                                  
tobacco                  0.017***        0.076**  
                         (0.005)         (0.026)  
                                                  
age                      0.008***       0.046***  
                         (0.002)         (0.010)  
                                                  
Constant                 -0.349*        -4.536*** 
                         (0.141)         (0.781)  
                                                  
--------------------------------------------------
Observations               462             462    
R2                        0.185                   
Adjusted R2               0.178                   
Log Likelihood                          -251.093  
Akaike Inf. Crit.                        512.187  
Residual Std. Error  0.432 (df = 457)             
==================================================
Note:                *p&lt;0.05; **p&lt;0.01; ***p&lt;0.001</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>In both models, all the coefficients except blood pressure are statistically significant and positively associated with the probability of having heart disease. Also, LDL is the most correlated variable with the probability of heart disease in both models.</strong></p>
</blockquote>
</section>
</section>
<section id="case-study-osteoporosis" class="level1">
<h1>Case Study: osteoporosis</h1>
<section id="background-1" class="level2">
<h2 class="anchored" data-anchor-id="background-1">Background</h2>
<ul>
<li><p>In <code>osteoporosis</code>, bones become weak and brittle, so weak that even bending over or coughing can fracture them. Hip, wrist, and spine fractures are the most common osteoporosis-related fractures.</p></li>
<li><p>All races of people are at risk for osteoporosis.</p></li>
<li><p>However, white and Asian women, particularly those that are post menopause, are at the greatest risk.</p></li>
<li><p>A healthy diet, weight-bearing exercises, and medications can strengthen weak bones or prevent their loss. (Mayo Clinic)</p></li>
</ul>
<p>Here, Our goal is description of the data:</p>
<ul>
<li><strong>How factors such as age and weight are related to the fracture rates among older women?</strong></li>
</ul>
<p>This sample comes from the Global Longitudinal Study of Osteoporosis in Women (GLOW).</p>
<p>The data set includes information on 500 subjects enrolled in this study.</p>
<p>Install and load the aplore3 library to use the glow500 dataset and understand the structure dataset.</p>
<p>We summarize some of the variables that we will use:</p>
<ul>
<li>PRIORFRAC: History of prior fracture</li>
<li>AGE: Age at enrollment</li>
<li>WEIGHT: Weight at enrollment (Kilograms)</li>
<li>HEIGHT: Height at enrollment (Centimeters)</li>
<li>BMI: Body mass index (<span class="math inline">kg/m^2</span>)</li>
<li>PREMENO: Menopause before age 45</li>
<li><code>FRACTURE</code>: Any fracture in first year of follow up (<code>target</code>)</li>
<li>RATERISK: Self-reported risk of fracture</li>
<li>SMOKE: Former or current smoker</li>
</ul>
</section>
<section id="task-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1">Task</h2>
<ul>
<li>Predict the probability of have a <code>fracture</code></li>
</ul>
</section>
<section id="eda-1" class="level2">
<h2 class="anchored" data-anchor-id="eda-1">EDA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> glow500 <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(fracture, age, priorfrac, premeno, raterisk, smoke, bmi)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">count</span>(fracture) <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(n),<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>,<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">'Fracture'</span>, <span class="st">'N'</span>, <span class="st">"Proportion"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Fracture</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">375</td>
<td style="text-align: right;">0.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">0.25</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Age has a higher age in women with fractures than women without fractures. BMI distributions have almost the same mean and same variance in both groups with and without fracture, so probably BMI is not a useful variable to classify these two groups</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wk2_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p><strong>From these box plots, we can see the women who suffered from a fracture are older, but both groups have the same distribution of BMI.</strong></p>
<p><strong>From the plots above, we see that the women with a history of prior fracture, and a high self-reported risk of fracture, have a higher probability of having a fracture in the first year of study. But, smokers and no smokers and women with or without menopause before 45 have the same probability of having a fracture. so smokers and menopause do not help classify these two groups, and we’re not going to use them for modeling</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Dependent: fracture</th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">No</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bmi</td>
<td style="text-align: left;">Mean (SD)</td>
<td style="text-align: left;">27.5 (6.0)</td>
<td style="text-align: left;">27.7 (5.9)</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: left;">Mean (SD)</td>
<td style="text-align: left;">67.5 (8.7)</td>
<td style="text-align: left;">71.8 (9.1)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">priorfrac</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">301 (80.3)</td>
<td style="text-align: left;">73 (58.4)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">74 (19.7)</td>
<td style="text-align: left;">52 (41.6)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">premeno</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">303 (80.8)</td>
<td style="text-align: left;">100 (80.0)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">72 (19.2)</td>
<td style="text-align: left;">25 (20.0)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">raterisk</td>
<td style="text-align: left;">Less</td>
<td style="text-align: left;">139 (37.1)</td>
<td style="text-align: left;">28 (22.4)</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Same</td>
<td style="text-align: left;">138 (36.8)</td>
<td style="text-align: left;">48 (38.4)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Greater</td>
<td style="text-align: left;">98 (26.1)</td>
<td style="text-align: left;">49 (39.2)</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoke</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">347 (92.5)</td>
<td style="text-align: left;">118 (94.4)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">28 (7.5)</td>
<td style="text-align: left;">7 (5.6)</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="glm-1" class="level2">
<h2 class="anchored" data-anchor-id="glm-1">GLM</h2>
<section id="simple-model" class="level3">
<h3 class="anchored" data-anchor-id="simple-model">simple model</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = fracture ~ bmi + age, family = binomial(link = logit), 
    data = df)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-1.21426  -0.77408  -0.62995  -0.07905   2.02854  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -5.83441    1.10792  -5.266 1.39e-07 ***
bmi          0.02692    0.01817   1.482    0.138    
age          0.05736    0.01211   4.735 2.20e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 562.34  on 499  degrees of freedom
Residual deviance: 538.89  on 497  degrees of freedom
AIC: 544.89

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p><span class="math display">
\log\left[ \frac { P( \operatorname{fracture} = \operatorname{Yes} ) }{ 1 - P( \operatorname{fracture} = \operatorname{Yes} ) } \right] = \alpha + \beta_{1}\cdot\operatorname{bmi} + \beta_{2}\cdot \operatorname{age}
</span></p>
<ul>
<li>Recall:</li>
</ul>
<p><span class="math display">
OR = \frac{Odds_{x_k+c}}{Odds_{x_k}}=exp(c \beta_k)
</span></p>
<ul>
<li>Find and interpret the estimated odds ratios for a 10-unit increase in age.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    [,1]
age 1.77</code></pre>
</div>
</div>
<p><strong>The estimated odds of having a fracture change by 1.77 times for every 10-year increase in age, or it’s 77% higher</strong></p>
</section>
<section id="model-with-categorical-feature" class="level3">
<h3 class="anchored" data-anchor-id="model-with-categorical-feature">model with categorical feature</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "No"  "Yes"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Less"    "Same"    "Greater"</code></pre>
</div>
</div>
<p><span class="math display">
\log\left[ \frac { P( \operatorname{fracture} = \operatorname{Yes} ) }{ 1 - P( \operatorname{fracture} = \operatorname{Yes} ) } \right] = \alpha + \beta_{1}\cdot \operatorname{bmi} + \beta_{2}\cdot \operatorname{age} + \beta_{3}\cdot \operatorname{priorfrac}_{\operatorname{Yes}} + \beta_{4}\cdot \operatorname{raterisk}_{\operatorname{Same}} + \beta_{5}\cdot \operatorname{raterisk}_{\operatorname{Greater}}
</span></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>